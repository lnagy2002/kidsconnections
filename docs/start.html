<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Card · The Mind Bits</title>

<style>
  :root{
    --bg:#0e364b;
    --panel:#0e364b;
    --text:#0e364b;
    --ink:#a9f4f4;
    --muted:#e8f2cc;
    --border:#1b2659;
    --ok:#4ade80;
    --no:#64748b;
    --maybe:#facc15;
    --bad:#e4572e;
    --ring:rgba(0,0,0,.08);
    --radius:15px;
    --seg-active:#111;
  }

  .wrap{display: grid;place-items:center;padding-top: 10%;}

  .card{
    width: min(500px, 85vw);
    border-radius:var(--radius);
    /* box-shadow:0 1px 0 var(--ring),0 8px 30px rgba(0,0,0,.06); */
    overflow:hidden;
    /* border:1px solid rgba(0,0,0,.06); */
  }

  /* ===== Header centered layout ===== */
  .header{
    background:#fff;
    display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
    gap:12px;padding:36px 20px 28px;border-bottom:1px solid rgba(0,0,0,.08);
  }

  .logo {
  width: min(200px, 40%);      /* responsive max width */
  aspect-ratio: 1 / 1;         /* square; or 16/9 if your logos are wide */
  border-radius: 18px;
  display: block;
  margin: 0 auto;
  overflow: hidden;
  background: #ccc;
}

.logo img {
  width: 100%;
  height: 100%;
  object-fit: contain;         /* show full logo, no cropping */
  border-radius: inherit;
  display: block;
}


  .title{font-size:27px;font-weight:600;line-height:1.3;padding-bottom: 10px;}
  .desc{color:var(--text);font-size:20px;max-width:420px;line-height:1.45;padding-bottom: 20px;}

  .body{padding:20px;display:grid;gap:18px;justify-items:center;text-align:center;}

  .seg{background:#fafafa1f ;color:#000;
    display:inline-flex;border-radius:5px;border:1px solid rgba(0,0,0,.12);padding:4px;}
  .seg button{appearance:none;border:0;background:transparent;padding:10px 14px;border-radius:5px;font-weight:500;
    letter-spacing:.2px;cursor:pointer;color:#222;font-size: 1rem;}
  .seg button[aria-pressed="true"]{background:#fafafa;color:#000; font-weight: 550;}
  .seg button:focus-visible{outline:2px solid var(--seg-active);outline-offset:2px;}

  .buttons{display:flex;justify-content:center;align-items:center;gap:12px;padding:0 20px 20px;}
  .meta{color:var(--muted);font-size:13px;}
  .play{appearance:none;border:0;cursor:pointer;border-radius:999px;padding:12px 18px;
    font-weight:800;letter-spacing:.3px;color:var(--muted);
    background:var(--bg);
  width: 120px;font-size: 1rem;}
  .play:disabled{opacity:.5;cursor:not-allowed;}

  .links{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
  .links a{color:#222;text-decoration:none;border-bottom:1px solid currentColor;}
  .links a:hover{opacity:.7;}

  .status{padding:24px;text-align:center;color:#666;}

  .date  {
    padding-bottom: 20px;
    font-weight:600;
  }

</style>
<link rel="stylesheet" href="https://lnagy2002.github.io/kidsconnections/games-utils.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KFSR46Z6C8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-KFSR46Z6C8');

</script>
</head>
<body>
<main class="start wrap">
  <article id="card" class="card" hidden>
    <header class="header">
      <div id="logo" class="logo" aria-hidden="true"></div>
    </header>

    <section class="body">
      <div>
        <div id="title" class="title games">Game Name</div>
        <div id="desc" class="desc">Short description of the game goes here.</div>
        <div class="seg" role="group" aria-label="Choose difficulty">
          <button type="button" data-level="easy"   aria-pressed="true">Easy</button>
          <button type="button" data-level="medium" aria-pressed="false">Medium</button>
          <button type="button" data-level="hard"   aria-pressed="false">Hard</button>
        </div>
      </div>
    </section>

    <div class="buttons">
      <!-- <div class="meta"><span id="slug">slug</span> • <span id="target-url">/play</span></div> -->
      <button id="play" class="play">Play</button>
    </div>
    <section style="text-align:center">
      <div id="date" class="date"></div>
    </section>
  </article>

  <div id="notFound" class="card" hidden>
    <div class="status">
      <div style="font-weight:800;margin-bottom:4px;">Game not found</div>
      <div>No game matches this id. Try one of these:</div>
      <div class="links" id="gameList" style="margin-top:12px;"></div>
    </div>
  </div>

  <div id="loading" class="card">
    <div class="status">Loading games…</div>
  </div>

  <div id="loadError" class="card" hidden>
    <div class="status">
      <div style="font-weight:800;margin-bottom:6px;">Couldn’t load games</div>
      <div>Check your <code>games.json</code> path (and avoid opening via <code>file://</code>; use a local server).</div>
    </div>
  </div>
</main>
<div>
  <script src="https://lnagy2002.github.io/kidsconnections/footer.js"></script>
</div>

<script>
/* ---------- Utilities ---------- */
const qs  = (s, el=document)=> el.querySelector(s);
const qsa = (s, el=document)=> [...el.querySelectorAll(s)];
const param = (name, fallback=null)=> new URLSearchParams(location.search).get(name) ?? fallback;
const setPressed = (btns, level)=> btns.forEach(b => b.setAttribute('aria-pressed', String(b.dataset.level === level)));

/* ---------- Elements ---------- */
const els = {
  card: qs('#card'),
  notFound: qs('#notFound'),
  loading: qs('#loading'),
  loadError: qs('#loadError'),
  gameList: qs('#gameList'),
  logo: qs('#logo'),
  title: qs('#title'),
  desc: qs('#desc'),
  // slug: qs('#slug'),
  // target: qs('#target-url'),
  play: qs('#play'),
  seg: qsa('.seg button')
};


/* ---------- External JSON loading ---------- */
/** JSON URL:
 *  - default: ./games.json
 *  - override with: ?data=https://example.com/games.json
 *  Format: array of games or object map keyed by id.
 */
const dataUrl = param('data', 'https://lnagy2002.github.io/kidsconnections/games-menu.json');

async function loadGames(url){
  const res = await fetch(url, { cache: 'no-cache' });
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return await res.json();
}

function normalize(input){
  const list = Array.isArray(input) ? input : Object.values(input || {});
  const cleaned = list.filter(Boolean).map(g => ({
    id: g.id,
    name: g.title,
    description: g.description,
    url: g.href,
    color: g.color,
    logoText: g.title,
    logoUrl: g.logo,
    defaultDifficulty: "easy"
  })).filter(g => g.id && g.name);
  return { list: cleaned, map: new Map(cleaned.map(g => [g.id, g])) };
}

function buildList(container, games){
  container.innerHTML = '';
  games.forEach(g=>{
    const a = document.createElement('a');
    const keepData = param('data') ? `&data=${encodeURIComponent(param('data'))}` : '';
    a.href = `${location.pathname}?id=${encodeURIComponent(g.id)}${keepData}`;
    a.textContent = g.name;
    container.appendChild(a);
  });
}

/* ---------- Boot ---------- */
(async () => {
  try {
    const t = new Date();

    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const formattedDate = t.toLocaleDateString(undefined, options);
    document.getElementById("date").textContent = formattedDate;

    const registry = await loadGames(dataUrl);
    const games = normalize(registry.games);
    if (!games.list.length) throw new Error('Empty games list');

    const id = param('id', games.list[0].id);
    const game = games.map.get(id);

    buildList(els.gameList, games.list);
    els.loading.hidden = true;

    if(!game){
      els.notFound.hidden = false;
      return;
    }

    // Accent color per game
    const accent = game.color || '#0e364b';
    document.documentElement.style.setProperty('--seg-active', accent);

    // Header/logo
    els.card.hidden = false;
    els.card.style.background = game.color;
    els.logo.innerHTML = '';
    if (game.logoUrl){
      const img = document.createElement('img');
      img.alt = `${game.name} logo`;
      img.src = game.logoUrl;
      img.onerror = () => {
        // graceful fallback to initials in the colored block
        els.logo.innerHTML = (game.logoText || game.name?.[0] || 'G').toUpperCase();
        els.logo.style.background = accent;
      };
      els.logo.style.background = 'transparent';
      els.logo.appendChild(img);
    } else {
      els.logo.textContent = (game.logoText || game.name?.[0] || 'G').toUpperCase();
      els.logo.style.background = accent;
    }

    // Copy
    els.title.textContent = game.name;
    els.desc.textContent  = game.description || '';
    console.log  ("-> sending event")
    window.parent.postMessage({ type: 'UPDATE_HEADER', game.name }, '*');

    // els.slug.textContent  = game.id;
    // els.target.textContent = game.url || '#';

    // Difficulty
    let level = (game.defaultDifficulty || 'easy').toLowerCase();
    if(!['easy','medium','hard'].includes(level)) level = 'easy';
    setPressed(els.seg, level);
    els.seg.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        level = btn.dataset.level;
        setPressed(els.seg, level);
        els.play.title = `Go to ${game.url}?level=${level}`;
      });
    });

    // Play → append ?difficulty=<level>
    els.play.addEventListener('click', ()=>{
      if(!game.url) return;
      // const path = `/kidsconnections/start.html`;
      // const path = `file:///Users/luminita/_personal/git/kidsconnections/docs/${game.url.replace(/^\//, '')}`;

      const path = `/kidsconnections/${game.url.replace(/^\//, '')}`;
      const u = new URL(path, location.origin);
      const sp = new URLSearchParams(u.search);
      sp.set('level', level);
      u.search = sp.toString();
      location.href = u.toString();
    });

    els.play.title = `Go to ${game.url}?level=${level}`;

  } catch (err) {
    console.error('Failed to load games:', err);
    els.loading.hidden = true;
    els.loadError.hidden = false;
  }
})();

if (window.self !== window.top) {
  document.body.classList.add('embedded');
}
</script>
</body>
</html>
