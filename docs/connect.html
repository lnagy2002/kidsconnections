<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kidsâ€™ Connections â€” Daily</title>
    <style>
         :root {
            --bg: #0e364b;
            --panel: #0e364b;
            --ink: #a9f4f4;
            --cell: #f0db79;
            --accent1: #3b82f6;
            --accent2: #22a699;
            --accent3: #f2b705;
            --accent4: #f25c54;
            --muted: #f0db79;
            --border: #1b2659;
            --key: #0f1736;
            --key-hover: #141f4a;
        }

        body {
            margin: 0;
            font-family: "Rubik", Trebuchet MS, Lucida Grande, Lucida Sans Unicode, Lucida Sans, Tahoma, sans-serif;
            background: var(--bg);
            color: var(--ink);
        }

        .app {
            margin: 20px auto;
            padding: 20px;
            border-radius: 14px;
            width: min(960px, 96vw);
        }

        @keyframes shake {
            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }
            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }
            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }
            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .shake {
            display: inline-block;
            /* so transform applies properly */
            animation: shake 0.5s ease-in-out;
        }

        .section {
            margin-top: 15px;
            text-align: center;
        }

        h1 {
            margin-bottom: 10px;
            margin-top: 0px;
        }

        .muted {
            color: var(--muted);
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .card {
            background-color: #a9f4f4;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            height: 100px;
            font-size: 16px;
            text-transform: uppercase;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
            background: #fff;
        }

        .card {
            display: flex;
            /* center text nicely */
            align-items: center;
            justify-content: center;
            line-height: 1.15;
            overflow: hidden;
            /* no scrollbars while shrinking */
            /* white-space: nowrap; */
            /* prefer shrinking over wrapping */
        }

        .card[aria-pressed="true"] {
            background: var(--cell);
        }

        .btn {
            background: var(--key);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 6px;
            font-weight: 400;
            font-size: 16px;
            color: var(--text);
            margin: 5px;
            width: 90px;
        }

        .btn.primary {
            background: #05a9ac;
            color: #000;
            border: none;
        }

        .found-row {
            color: #000;
            display: flex;
            align-items: center;
            margin: 6px 0;
            border-radius: 10px;
            padding: 6px;
            height: 100px;
            font-size: 16px;
            text-transform: uppercase;
        }

        .found-label {
            text-align: center;
            font-weight: bold;
            margin-right: 10px;
            padding: 4px 8px;
            border-radius: 6px;
        }
        /* .found-items { display:flex; flex:1; gap:6px;} */

        .found-item {
            text-align: center;
            padding: 6px;
            border-radius: 6px;
            background: #f0f0f0;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 10px 12px;
        }

        .field {
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #223064;
            background: #0c1431;
            color: var(--ink);
            font-size: 16px;
        }

        .title-block {
            display: flex;
            flex-direction: column;
            /* align-items: center; /* centers both title & date */
            */
        }

        @media (max-width: 600px) {
            .app {
                margin: 10px auto;
                padding: 10px;
            }

            .grid {
                gap: 2px;
                margin-top: 10px;
            }

            .card {
                padding: 8px;
                height: min(100px, 10vh);
                font-size: 14px;
            }

            .found-row {

                margin: 6px 0;
                border-radius: 10px;
                height: min(100px, 10vh);
                text-transform: uppercase;
            }
        }
        /* .complete-badge { margin-left:10px; font-size:12px; color:#fff; background:green; padding:2px 6px; border-radius:6px;} */
    </style>
</head>

<body>

    <div class="app">
        <section class="panel controls">
            <img src="https://bittobitscom.wordpress.com/wp-content/uploads/2025/08/logo-round-3.png" alt="" height="100px">
            <div class="title-block">
                <h1>Kidsâ€™ Connections</h1>
                <!-- <label>Pick the Right Challenge Level (by Grade)
              <select id="level" class="field">
                <option value="easy">Easy (Grades 2â€“3)</option>
                <option value="medium">Medium (Grades 4-5)</option>
                <option value="hard">Hard (Grades 6+)</option>
              </select>
            </label> -->
                <div id="date"></div>
            </div>
        </section>
        <hr>
        <h3 class="section">Create four groups of four!</h3>
        <div id="msg" class="muted" style="margin-left:auto">Daily categories</div>
        <div id="foundContainer"></div>
        <div id="grid" class="grid"></div>
        <div class="section">
            <button id="btnSubmit" class="btn primary">Submit</button>
            <button id="btnShuffle" class="btn">Shuffle</button>
            <!-- <button id="btnHint" class="btn">Hint</button> -->
            <button id="btnReset" class="btn">Start Over</button>
        </div>

    </div>
    <script>
        const today = new Date();

        // Format it as Month Day, Year (e.g., August 20, 2025)
        const options = {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        };
        const formattedDate = today.toLocaleDateString(undefined, options);

        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const dd = String(today.getDate()).padStart(2, '0');
        const yyyy = today.getFullYear();

        const formattedFileDate = mm + dd + yyyy;
        // Insert into HTML
        document.getElementById("date").textContent = formattedDate;
    </script>
    <script>
        function showMessage(text) {
            document.getElementById("msg").textContent = text;
        }
    </script>
    <script>
        let state = {
            level: "easy",
            selected: new Set(),
            solved: [],
            items: []
        };
        let PUZZLE_BANK = {};

        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name); // returns null if not found
        }

        async function loadData() {
            const level = getQueryParam('level');
            console.log(level)
            try {
                const res = await fetch('https://lnagy2002.github.io/kidsconnections/data/daily-' + formattedFileDate + ".json"); // <-- your JSON file
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                PUZZLE_BANK = await res.json();
                init(level || "easy"); // render it
            } catch (err) {
                const c = document.getElementById('grid');
                c.innerHTML = `<p class="error">Couldnâ€™t load data: ${err.message}</p>`;
                setTimeout(() => c.firstChild?.remove(), 5000); // auto-hide after 5s (optional)
            }
        }

        function init(level) {
            state.level = level;
            state.solved = [];
            state.selected = new Set();
            const groups = PUZZLE_BANK[level].groups;
            showMessage();

            // available colors
            const colors = [
                "var(--accent1)",
                "var(--accent2)",
                "var(--accent3)",
                "var(--accent4)"
            ];

            // shuffle colors so each group gets a unique one
            const shuffled = [...colors].sort(() => Math.random() - 0.5);

            // assign each group a unique color
            groups.forEach((g, i) => {
                g.color = shuffled[i % shuffled.length];
            });

            state.items = groups.flatMap(g =>
                g.items.map(t => ({
                    text: t,
                    group: g.name,
                    color: g.color
                }))
            );

            state.items.sort(() => Math.random() - 0.5);
            render();
        }

        function render() {
            const grid = document.getElementById("grid");
            grid.innerHTML = "";
            state.items.forEach(it => {
                if (state.solved.some(g => g.items.includes(it.text))) return;
                const b = document.createElement("button");
                b.className = "card";
                b.textContent = it.text;
                b.setAttribute("aria-pressed", state.selected.has(it.text));
                b.onclick = () => toggle(it.text);
                grid.appendChild(b);
            });
            renderFound();
            fitAllCards();
        }

        function renderFound() {
            const c = document.getElementById("foundContainer");
            c.innerHTML = "";
            state.solved.forEach(g => {
                const row = document.createElement("div");
                row.className = "found-row";
                row.style.background = g.color;
                const label = document.createElement("h3");
                label.className = "found-label";
                // label.style.background=g.color;
                // label.style.color="#fff";
                label.textContent = g.groupName;
                // const badge=document.createElement("span");
                // badge.className="complete-badge";
                // badge.textContent="âœ“ Complete";
                // label.appendChild(badge);
                const itemsDiv = document.createElement("div");
                itemsDiv.className = "found-items";
                itemsDiv.textContent = g.items.join(", ");
                // g.items.forEach(it=>{
                //   const span=document.createElement("div");
                //   span.className="found-item";
                //   span.style.background=g.color; span.style.color="#fff";
                //   span.textContent=it;
                //   itemsDiv.appendChild(span);
                // });
                row.appendChild(label);
                row.appendChild(itemsDiv);
                c.appendChild(row);
            });
        }

        function toggle(t) {
            if (state.selected.has(t)) state.selected.delete(t);
            else {
                if (state.selected.size >= 4) {
                    showMessage("4 tiles already selected");
                    return;
                }
                state.selected.add(t);
            }
            render();
        }

        function submit() {
            if (state.selected.size !== 4) return showMessage("Need 4 tiles");
            const chosen = Array.from(state.selected);
            const groups = PUZZLE_BANK[state.level].groups;
            for (const g of groups) {
                if (g.items.every(x => chosen.includes(x))) {
                    state.solved.push({
                        groupName: g.name,
                        items: g.items,
                        color: g.color
                    });
                    state.selected.clear();
                    // showMessage("ðŸ§© Yes! Those tiles belong together!")
                    render();
                    if (state.solved.length === 4) showMessage("ðŸŽ‰ You got it!");
                    return;
                }
            }

            shakeSelectedThenRerender();
        }

        function shakeSelectedThenRerender() {
            const tiles = Array.from(document.querySelectorAll('.card[aria-pressed="true"]'));

            // Add the shake class and clean it up when the animation ends
            tiles.forEach(el => {
                el.classList.add('shake');
                const cleanup = () => el.classList.remove('shake');
                el.addEventListener('animationend', cleanup, {
                    once: true
                }); // fires when CSS animation finishes
                el.addEventListener('animationcancel', cleanup, {
                    once: true
                }); // safety if animation is aborted
            });

            // After the short animation, clear selection and re-render
            setTimeout(() => {
                state.selected.clear();
                render();
            }, 520);
        }

        document.getElementById("btnSubmit").onclick = submit;
        document.getElementById("btnShuffle").onclick = () => {
            state.items.sort(() => Math.random() - 0.5);
            render();
        };
        document.getElementById("btnReset").onclick = () => init(state.level);
        // document.getElementById("btnHint").onclick = () => showMessage("Look for 4 things that belong together!");
        // document.getElementById("level").onchange = (e) => init(e.target.value);

        // Shrink text inside an element until it fits its box (both width & height)
        // Respects a minimum font size so it never becomes unreadable.
        function shrinkToFit(el, {
            minPx = 10,
            step = 1
        } = {}) {
            // Start from the computed (or explicitly set) font size each time
            el.style.fontSize = ""; // reset before measuring
            const computed = window.getComputedStyle(el);
            let fontSize = parseFloat(computed.fontSize);

            // Guard: if fontSize can't be parsed, fall back to 16px
            if (!Number.isFinite(fontSize)) fontSize = 16;

            // While content overflows horizontally OR vertically, shrink
            // Note: client* excludes scrollbars; scroll* shows content size
            // Also account for a tiny epsilon due to subpixel rounding.
            const fits = () =>
                el.scrollWidth <= el.clientWidth + 0.5 &&
                el.scrollHeight <= el.clientHeight + 0.5;

            // If it already fits, we're done
            if (fits()) return;

            // Try shrinking down to minPx
            while (!fits() && fontSize > minPx) {
                fontSize -= step;
                el.style.fontSize = fontSize + "px";
            }
        }

        // Apply to all visible tiles
        function fitAllCards() {
            const cards = document.querySelectorAll(".card");
            cards.forEach((card) => shrinkToFit(card, {
                minPx: 10,
                step: 1
            }));
        }


        loadData();
    </script>
</body>

</html>
